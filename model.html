<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1, minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="description" content="Sweet Potato is an opinionated and minimal static website generator, by We The Collective."><title>Sweet Potato: Model</title><link rel="stylesheet" href="./index.css"></head><body><header class="grid"><div class="main-content"><h1>Sweet Potato üç†</h1></div></header><main class="grid"><div class="main-content"><h1>Model</h1>
<p>The model - or runtime globals - system allows you to populate an object with variables statically, dynamically or drawn from an API at compile time and provide them to pug for use in template rendering.</p>
<h2>Functionality</h2>
<p>The model itself is just a node js file that's consumed at compile time. This file could contain anything you want as long as it returns a promise. As such you can use this file to consume other files, to determine the status of various OS properties, or to query APIs.</p>
<h2>Usage</h2>
<p>To compile data for this object you would create a data folder relative to the page you wanted to apply it to. For example if you wanted to compile some news data, your folder structure might look like this:</p>
<pre><code>pages/
  |-- index.pug
  |-- about/
      |-- index.pug
  |-- news/
      |-- data/
          |-- index.js
      |-- index.pug
</code></pre>
<p>The compiler will consume data/index.js file and append the result of its promise to the model object of the pug file.</p>
<h3>Example</h3>
<p>Given the following folder structure:</p>
<pre><code>pages/
  |-- index.pug
  |-- data/
      |-- index.js
</code></pre>
<p>The contents of data/index.js:</p>
<pre><code>module.exports = async function () {
  const data = {
    testing: &quot;Hello World&quot;,
  };
  return new Promise((resolve, reject) =&gt; {
    resolve(data);
  });
};
</code></pre>
<p>In index.pug:</p>
<pre><code>p!= model.testing
</code></pre>
<p>Will output &quot;Hello World&quot;.</p>
<h2>Patterns</h2>
<p>Following are some useful patterns for the use of the model system.</p>
<h3>Read data files</h3>
<p>If you just want to have some files that you read the data from you can create a series of yamle files and consume them with the model index.js.</p>
<p>Given the following folder structure:</p>
<pre><code>pages/
  |-- index.pug
  |-- data/
      |-- index.js
      |-- data.yaml
      |-- events.yaml
</code></pre>
<p>The contents of data/index.js:</p>
<pre><code>const yaml = require(&quot;js-yaml&quot;);
const fse = require(&quot;fs-extra&quot;);
const path = require(&quot;path&quot;);

async function readYaml(file) {
  let result = {};

  if (!fse.pathExistsSync(file)) return result;

  try {
    const content = await fse.readFile(file, &quot;utf8&quot;);
    result = yaml.load(content);
  } catch (error) {
    logger.error([`Can't compile yaml`, file], error);

    throw error;
  }

  return result;
}

module.exports = async function (relativepath) {
  const data = { };

  const datafiles = {};
  await fse.readdir(relativepath).then((filenames) =&gt; {
    for (let i = 0; i &lt; filenames.length; i++) {
      const filename = filenames[i];
      if (path.extname(filename) === &quot;.yaml&quot;) {
        datafiles[filename.split(&quot;.&quot;)[0]] = path.join(relativepath, filename);
      }
    }
  });
  for (let i in datafiles) {
    data[i] = await readYaml(datafiles[i]);
  }

  return data;
};
</code></pre>
<p>And the contents of events.yaml:</p>
<pre><code>event1: &quot;name:trackingID, stuiteID:2&quot;
</code></pre>
<p>You could then address this event by using <code>model.events.event1</code> in your pug template.</p>
<h3>Read files to generate a navigation</h3>
<p>TO-DO</p>
<h3>Read an API to provide static data to your template</h3>
<p>TO-DO</p>
</div><div class="main-navigation"><nav class="main-navigation"><ul class="nav main-navigation__nav"><li><a href="https://wethegit.github.io/sweet-potato/index.html">Introduction</a></li><li><a href="https://wethegit.github.io/sweet-potato/config.html">Configuration</a></li><li><a href="https://wethegit.github.io/sweet-potato/pages.html">Pages</a></li><li><a href="https://wethegit.github.io/sweet-potato/language.html">Language and localisation</a></li><li><a href="https://wethegit.github.io/sweet-potato/model.html">Model</a></li><li><a href="https://wethegit.github.io/sweet-potato/js.html">Javascript</a></li><li><a href="https://wethegit.github.io/sweet-potato/styles.html">Styles</a></li><li><a href="https://wethegit.github.io/sweet-potato/envs.html">Environments and environment variables</a></li><li><a href="https://wethegit.github.io/sweet-potato/statics.html">Static assets</a></li><li><a href="https://wethegit.github.io/sweet-potato/dev.html">Sweet Potato development</a></li></ul></nav></div></main><script type="module" src="./index.js"></script></body></html>